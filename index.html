<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Atla — AI Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Atla — Conversational AI Agent built by Sai Pranav Atla" />
  <meta name="color-scheme" content="dark" />
  <!-- Keep your entire existing CSS exactly as-is -->
</head>
<body>

  <!-- NAV -->
  <nav class="nav">
    <div class="nav-logo">atla<span>.in</span></div>
    <div class="nav-links">
      <a href="https://github.com/saipranavAtla" target="_blank">GitHub</a>
      <a href="https://linkedin.com/in/saipranavAtla" target="_blank">LinkedIn</a>
      <span class="nav-badge">v1.0 live</span>
    </div>
  </nav>

  <div class="app-shell">

    <main class="chat-card">
      <header class="chat-header">
        <div class="title-group">
          <span class="badge">
            <span class="badge-dot"></span>
            Atla AI
          </span>
          <div class="app-title">
            Conversational Agent
            <span>RAG · Memory · FastAPI</span>
          </div>
        </div>
        <div class="header-actions">
          <button class="ghost-button" onclick="clearChat()">Clear</button>
          <span class="pill" id="backend-pill">Checking...</span>
        </div>
      </header>

      <div id="chat-box" class="chat-box">
        <div class="placeholder-copy">
          Ask me anything. Persistent memory enabled.
        </div>
      </div>

      <div class="input-row">
        <input
          type="text"
          id="user-input"
          placeholder="Ask me anything…"
          autocomplete="off"
          onkeydown="if(event.key === 'Enter') sendMessage()"
        />
        <button class="send-button" id="send-button" onclick="sendMessage()">
          ➤ Send
        </button>
      </div>

      <div id="error-banner" class="error-banner"></div>
    </main>

  </div>

  <footer class="footer">
    atla.in · Built by <a href="https://linkedin.com/in/saipranavAtla">Sai Pranav Atla</a> · 2026
  </footer>

  <script>
    const API_BASE =
      window.location.hostname === "localhost" ||
      window.location.hostname === "127.0.0.1"
        ? "http://127.0.0.1:8000"
        : "https://atla-main.up.railway.app";

    async function checkHealth() {
      try {
        const r = await fetch(`${API_BASE}/health`);
        const d = await r.json();
        document.getElementById("backend-pill").textContent =
          d.backend || "online";
      } catch {
        document.getElementById("backend-pill").textContent = "offline";
      }
    }

    checkHealth();

    function clearChat() {
      const box = document.getElementById("chat-box");
      box.innerHTML = `
        <div class="placeholder-copy">
          Ask me anything. Persistent memory enabled.
        </div>`;
    }

    function appendMessage(role, text, loading = false) {
      const box = document.getElementById("chat-box");

      box.querySelector(".placeholder-copy")?.remove();

      const msg = document.createElement("div");
      msg.className = `message ${role}`;

      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.textContent = role === "user" ? "You" : "AI";

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      if (loading) bubble.classList.add("loading");
      bubble.textContent = text;

      msg.appendChild(avatar);
      msg.appendChild(bubble);
      box.appendChild(msg);

      box.scrollTop = box.scrollHeight;
      return bubble;
    }

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const errorEl = document.getElementById("error-banner");
      const sendBtn = document.getElementById("send-button");
      const userText = input.value.trim();

      if (!userText) return;

      errorEl.style.display = "none";
      appendMessage("user", userText);
      input.value = "";
      sendBtn.disabled = true;

      const aiBubble = appendMessage("ai", "Thinking…", true);

      try {
        const res = await fetch(`${API_BASE}/generate/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: userText }),
        });

        if (!res.ok) throw new Error(`Server returned ${res.status}`);

        const data = await res.json();
        aiBubble.classList.remove("loading");
        aiBubble.textContent = data.response ?? "(no response)";
      } catch (err) {
        aiBubble.classList.remove("loading");
        aiBubble.textContent = "Backend unreachable.";
        errorEl.textContent = err.message;
        errorEl.style.display = "block";
      } finally {
        sendBtn.disabled = false;
        input.focus();
      }
    }
  </script>

</body>
</html>